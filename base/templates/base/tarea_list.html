{% extends 'base/principal.html' %}

{% block content %}

<div class="barra-superior">

    <div class="info-usuario">
        <h1>Hola {{ request.user }}</h1>
        <h3>
            Tienes <i>{{ count }}</i>
            tarea{{ count|pluralize }}
            incompleta{{ count|pluralize }}
        </h3>
    </div>

    <div class="acciones">

         <div class="notificaciones">
    <span class="campana" onclick="toggleAlertas()">ğŸ””</span>

    {% if alertas.count %}
        <span class="badge">{{ alertas.count }}</span>
    {% endif %}

    <div id="panel-alertas" class="panel-alertas">
        <h4>â° Por vencer</h4>

        {% for tarea in alertas %}
            <div class="alerta-item">
                <strong>{{ tarea.titulo }}</strong><br>
                <small>vence {{ tarea.fecha_limite|date:"d/m/Y" }}</small>
            </div>
        {% empty %}
            <p>No hay alertas</p>
        {% endfor %}
    </div>
</div>


        <!-- SALIR -->
        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button class="boton" type="submit">Salir</button>
        </form>

    </div>
</div>

<h1 class="titulo-principal brillo">Lista de Pendientes 2026</h1>

<div id="envoltorio-agregar-buscar">
    <form method="get" class="form-buscar">
        <div class="campo-buscar">
            <input
                type="text"
                name="area-buscar"
                value="{{ valor_buscado }}"
                placeholder="Buscar tarea..."
            >
        </div>
        <button type="submit" class="btn-buscar">Buscar</button>
    </form>
</div>

<!-- ================= PENDIENTES DEL DÃA ================= -->
<h2 style="padding: 0 40px;">Pendientes del dÃ­a</h2>

<div class="envoltorio-items-tarea">
    {% for tarea in tareas_dia %}
        <div class="envoltorio-tarea">
            <div class="titulo-tarea">
                <a href="{% url 'editar-tarea' tarea.id %}">{{ tarea }}</a>
            </div>
            <a class="enlace-eliminar" href="{% url 'eliminar-tarea' tarea.id %}">âœ˜</a>
        </div>
    {% empty %}
        <p style="padding: 0 40px;">No hay tareas para hoy</p>
    {% endfor %}
</div>

<!-- ================= PENDIENTES A LARGO PLAZO ================= -->
<h2 style="padding: 0 40px; margin-top: 40px;">Pendientes a largo plazo</h2>

<div class="envoltorio-items-tarea">
    {% for tarea in tareas_anio %}
        <div class="envoltorio-tarea">
            <div class="titulo-tarea">
                <a href="{% url 'editar-tarea' tarea.id %}">{{ tarea }}</a>
                <small style="margin-left:12px; color:#5f7f7a;">
                    â€” tienes tiempo hasta {{ tarea.fecha_limite|date:"d/m/Y" }}
                </small>
            </div>
            <a class="enlace-eliminar" href="{% url 'eliminar-tarea' tarea.id %}">âœ˜</a>
        </div>
    {% empty %}
        <p style="padding: 0 40px;">No hay tareas a largo plazo</p>
    {% endfor %}
</div>

<div style="padding:40px; text-align:center;">
    <a class="boton" href="{% url 'crear-tarea' %}">Agregar tarea</a>
</div>

<!-- JS ALERTAS -->
<script>
function toggleAlertas() {
    const panel = document.getElementById("panel-alertas");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
}
</script>

{% endblock %}
